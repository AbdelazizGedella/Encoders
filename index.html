<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encoding Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body {
            background-color: #343a40;
            color: white;
            font-family: Arial, sans-serif;
        }
        h1, h2 {
            color: #ffc107;
        }
        .divider {
            border-top: 1px solid #ffc107;
            margin: 20px 0;
        }
        .form-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
            background-color: #495057;
        }
        .hidden-section {
            display: none;
        }
        .btn-custom {
            background-color: #ffc107;
            color: #343a40;
            border: none;
        }
    </style>
</head>
<body>

<div class="container form-container">
    <h1>Encoding Report</h1>
    <form id="reportForm">
        <label>Title:</label> <span>Encoding Report</span><br><br>

        <label>Date:</label> <span id="todayDate"></span><br><br>

        <label for="shift">Shift:</label>
        <select id="shift" class="form-select">
            <option value="Day">Day</option>
            <option value="Night">Night</option>
        </select><br>

        <div class="divider"></div>

        <label for="mrNo">Patient MRNo.:</label>
        <input type="text" id="mrNo" class="form-control mb-3">

        <div class="divider"></div>

        <h2>Prescription Issues</h2>
        <button type="button" class="btn btn-custom mb-3" onclick="togglePrescriptionSection()">(+ Prescription Issue)</button>
        
        <div id="prescriptionIssuesContainer" class="hidden-section">
            <div class="prescription-entry mb-4">
                <label for="prescriptionIssue">Prescription Issue:</label>
                <input type="text" class="form-control prescriptionIssue" placeholder="Enter drug name and dose"><br>

                <label for="physician">Physician:</label>
                <input type="text" class="form-control physician" placeholder="Enter physician name"><br>

                <label>Issue related:</label><br>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Code"> 
                    <label class="form-check-label">Code</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Qty"> 
                    <label class="form-check-label">Qty</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Dose"> 
                    <label class="form-check-label">Dose</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Both"> 
                    <label class="form-check-label">Both</label>
                </div><br><br>

                <label>Solution:</label>
                <select class="form-select solution">
                    <option value="Changed code">Changed code</option>
                    <option value="Changed Qty">Changed Qty</option>
                    <option value="Changed Dose">Changed Dose</option>
                    <option value="Both">Both</option>
                    <option value="Cancelled">Cancelled</option>
                </select><br><br>
            </div>
        </div>

        <div class="divider"></div>

        <label>No. of Cancelled Orders:</label>
        <input type="number" id="cancelledOrders" class="form-control mb-3">

        <label>Not Available Qty Medications:</label>
        <input type="text" id="notAvailableMedications" class="form-control mb-3" placeholder="Enter medications name">

        <label>Not Available Qty Consumables:</label>
        <input type="text" id="notAvailableConsumables" class="form-control mb-3" placeholder="Enter consumables name">

        <div class="divider"></div>

        <label>Updates:</label>
        <textarea id="updates" class="form-control" rows="3"></textarea><br>

        <button type="button" class="btn btn-custom" onclick="generatePDF()">Submit</button>
    </form>
</div>

<script>
    // Display today's date
    document.getElementById('todayDate').innerText = new Date().toLocaleDateString();

    // Toggle visibility of the prescription issues section
    function togglePrescriptionSection() {
        const container = document.getElementById('prescriptionIssuesContainer');
        container.classList.toggle('hidden-section');
    }

    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Collect data from form
        const shift = document.getElementById('shift').value;
        const mrNo = document.getElementById('mrNo').value;

        // Add data to PDF
        doc.text("Encoding Report", 10, 10);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, 20);
        doc.text(`Shift: ${shift}`, 10, 30);
        doc.text(`Patient MRNo.: ${mrNo}`, 10, 40);

        // Loop through Prescription Issues
        let yOffset = 50;
        document.querySelectorAll('.prescription-entry').forEach((entry, index) => {
            const prescriptionIssue = entry.querySelector('.prescriptionIssue').value;
            const physician = entry.querySelector('.physician').value;

            // Collect checkbox values for issue related
            const issueRelated = Array.from(entry.querySelectorAll('.issueRelated:checked'))
                .map(checkbox => checkbox.value).join(', ');

            const solution = entry.querySelector('.solution').value;

            // Add to PDF
            doc.text(`Prescription Issue #${index + 1}: ${prescriptionIssue}`, 10, yOffset);
            doc.text(`Physician: ${physician}`, 10, yOffset + 10);
            doc.text(`Issue Related: ${issueRelated}`, 10, yOffset + 20);
            doc.text(`Solution: ${solution}`, 10, yOffset + 30);
            yOffset += 40;
        });

        // Remaining fields
        const cancelledOrders = document.getElementById('cancelledOrders').value;
        const notAvailableMedications = document.getElementById('notAvailableMedications').value;
        const notAvailableConsumables = document.getElementById('notAvailableConsumables').value;
        const updates = document.getElementById('updates').value;

        doc.text(`No. of Cancelled Orders: ${cancelledOrders}`, 10, yOffset);
        doc.text(`Not Available Qty Medications: ${notAvailableMedications}`, 10, yOffset + 10);
        doc.text(`Not Available Qty Consumables: ${notAvailableConsumables}`, 10, yOffset + 20);
        doc.text(`Updates: ${updates}`, 10, yOffset + 30);

        // Save PDF
        doc.save('Encoding_Report.pdf');
    }
</script>

</body>
</html>
