<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encoding Report</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .divider {
            border-top: 1px solid #ffffff;
            margin: 20px 0;
        }
        .hidden-section {
            display: none;
        }
        .header {
            background-color: #1538a4;
            padding: 20px;
            color: white;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .btn-custom {
            background-color: #33a2ff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Encoding Report</h1>
        </div>

        <form id="reportForm">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="date">Date:</label>
                    <input type="text" class="form-control" id="date" readonly>
                </div>
                <div class="form-group col-md-6">
                    <label for="shift">Shift:</label>
                    <select id="shift" class="form-control">
                        <option value="Day">Day</option>
                        <option value="Night">Night</option>
                    </select>
                </div>
            </div>

            <div class="divider"></div>

            <div class="form-group">
                <label for="mrNo">Patient MRNo.:</label>
                <input type="text" id="mrNo" class="form-control mb-3">
            </div>

            <div class="divider"></div>

            <h4>Prescription Issues</h4>
            <button type="button" class="btn btn-custom mb-3" onclick="addPrescriptionIssue()">+ Prescription Issue</button>

            <div id="prescriptionIssuesContainer"></div>

            <div class="divider"></div>

            <div class="form-group">
                <label for="cancelledOrders">No. of Cancelled Orders:</label>
                <input type="number" id="cancelledOrders" class="form-control mb-3">
            </div>

            <div class="form-group">
                <label for="notAvailableMedications">Not Available Qty Medications:</label>
                <input type="text" id="notAvailableMedications" class="form-control mb-3">
            </div>

            <div class="form-group">
                <label for="notAvailableConsumables">Not Available Qty Consumables:</label>
                <input type="text" id="notAvailableConsumables" class="form-control mb-3">
            </div>

            <div class="divider"></div>

            <div class="form-group">
                <label for="updates">Updates:</label>
                <textarea id="updates" class="form-control" rows="3"></textarea>
            </div>

            <button type="button" class="btn btn-primary" onclick="generatePDF()">Submit</button>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        document.getElementById('date').value = new Date().toLocaleDateString();

        function addPrescriptionIssue() {
            const container = document.getElementById('prescriptionIssuesContainer');
            
            // Create a new Prescription Issue entry
            const prescriptionEntry = document.createElement('div');
            prescriptionEntry.classList.add('prescription-entry', 'mb-4', 'p-3', 'bg-dark', 'border', 'border-white', 'rounded');

            prescriptionEntry.innerHTML = `
                <label for="prescriptionIssue">Prescription Issue:</label>
                <input type="text" class="form-control prescriptionIssue mb-2" placeholder="Enter drug name and dose">

                <label for="physician">Physician:</label>
                <input type="text" class="form-control physician mb-2" placeholder="Enter physician name">

                <label>Issue related:</label><br>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Code"> 
                    <label class="form-check-label">Code</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Qty"> 
                    <label class="form-check-label">Qty</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Dose"> 
                    <label class="form-check-label">Dose</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input issueRelated" value="Both"> 
                    <label class="form-check-label">Both</label>
                </div><br><br>

                <label>Solution:</label>
                <select class="form-control solution mb-2">
                    <option value="Changed code">Changed code</option>
                    <option value="Changed Qty">Changed Qty</option>
                    <option value="Changed Dose">Changed Dose</option>
                    <option value="Both">Both</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            `;

            // Append to the container
            container.appendChild(prescriptionEntry);
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const shift = document.getElementById('shift').value;
            const mrNo = document.getElementById('mrNo').value;

            doc.text("Encoding Report", 10, 10);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, 20);
            doc.text(`Shift: ${shift}`, 10, 30);
            doc.text(`Patient MRNo.: ${mrNo}`, 10, 40);

            let yOffset = 50;
            document.querySelectorAll('.prescription-entry').forEach((entry, index) => {
                const prescriptionIssue = entry.querySelector('.prescriptionIssue').value;
                const physician = entry.querySelector('.physician').value;
                const issueRelated = Array.from(entry.querySelectorAll('.issueRelated:checked'))
                    .map(checkbox => checkbox.value).join(', ');
                const solution = entry.querySelector('.solution').value;

                doc.text(`Prescription Issue #${index + 1}: ${prescriptionIssue}`, 10, yOffset);
                doc.text(`Physician: ${physician}`, 10, yOffset + 10);
                doc.text(`Issue Related: ${issueRelated}`, 10, yOffset + 20);
                doc.text(`Solution: ${solution}`, 10, yOffset + 30);
                yOffset += 40;
            });

            const cancelledOrders = document.getElementById('cancelledOrders').value;
            const notAvailableMedications = document.getElementById('notAvailableMedications').value;
            const notAvailableConsumables = document.getElementById('notAvailableConsumables').value;
            const updates = document.getElementById('updates').value;

            doc.text(`No. of Cancelled Orders: ${cancelledOrders}`, 10, yOffset);
            doc.text(`Not Available Qty Medications: ${notAvailableMedications}`, 10, yOffset + 10);
            doc.text(`Not Available Qty Consumables: ${notAvailableConsumables}`, 10, yOffset + 20);
            doc.text(`Updates: ${updates}`, 10, yOffset + 30);

            doc.save('Encoding_Report.pdf');
        }
    </script>
</body>
</html>
