<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encoding Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        label { font-weight: bold; }
        .container { max-width: 600px; margin: 0 auto; }
        .entry { margin-bottom: 10px; }
        .add-more { color: blue; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>Encoding Report</h1>
    <form id="reportForm">
        <label>Title:</label> <span>Encoding Report</span><br><br>

        <label>Date:</label> <span id="todayDate"></span><br><br>

        <label for="shift">Shift:</label>
        <select id="shift">
            <option value="Day">Day</option>
            <option value="Night">Night</option>
        </select><br><br>

        <label for="mrNo">Patient MRNo.:</label>
        <input type="text" id="mrNo"><br><br>

        <h2>Prescription Issues</h2>
        <div id="prescriptionIssuesContainer">
            <div class="prescription-entry">
                <label for="prescriptionIssue">Prescription Issue:</label>
                <input type="text" class="prescriptionIssue" placeholder="Enter drug name and dose"><br><br>

                <label for="physician">Physician:</label>
                <input type="text" class="physician" placeholder="Enter physician name"><br><br>

                <label>Issue related:</label><br>
                <input type="checkbox" class="issueRelated" value="Code"> Code
                <input type="checkbox" class="issueRelated" value="Qty"> Qty
                <input type="checkbox" class="issueRelated" value="Dose"> Dose
                <input type="checkbox" class="issueRelated" value="Both"> Both<br><br>

                <label>Solution:</label>
                <select class="solution">
                    <option value="Changed code">Changed code</option>
                    <option value="Changed Qty">Changed Qty</option>
                    <option value="Changed Dose">Changed Dose</option>
                    <option value="Both">Both</option>
                    <option value="Cancelled">Cancelled</option>
                </select><br><br>
            </div>
        </div>

        <button type="button" onclick="addPrescriptionIssue()">(+ Prescription Issue)</button><br><br>

        <label>No. of Cancelled Orders:</label>
        <input type="number" id="cancelledOrders"><br><br>

        <label>Not Available Qty Medications:</label>
        <input type="text" id="notAvailableMedications" placeholder="Enter medications name"><br><br>

        <label>Not Available Qty Consumables:</label>
        <input type="text" id="notAvailableConsumables" placeholder="Enter consumables name"><br><br>

        <label>Updates:</label>
        <textarea id="updates" rows="3"></textarea><br><br>

        <button type="button" onclick="generatePDF()">Submit</button>
    </form>
</div>

<script>
    // Display today's date
    document.getElementById('todayDate').innerText = new Date().toLocaleDateString();

    // Function to add a new "Prescription Issue" entry
    function addPrescriptionIssue() {
        const container = document.getElementById('prescriptionIssuesContainer');
        const entry = document.createElement('div');
        entry.className = 'prescription-entry';
        entry.innerHTML = `
            <label>Prescription Issue:</label>
            <input type="text" class="prescriptionIssue" placeholder="Enter drug name and dose"><br><br>

            <label>Physician:</label>
            <input type="text" class="physician" placeholder="Enter physician name"><br><br>

            <label>Issue related:</label><br>
            <input type="checkbox" class="issueRelated" value="Code"> Code
            <input type="checkbox" class="issueRelated" value="Qty"> Qty
            <input type="checkbox" class="issueRelated" value="Dose"> Dose
            <input type="checkbox" class="issueRelated" value="Both"> Both<br><br>

            <label>Solution:</label>
            <select class="solution">
                <option value="Changed code">Changed code</option>
                <option value="Changed Qty">Changed Qty</option>
                <option value="Changed Dose">Changed Dose</option>
                <option value="Both">Both</option>
                <option value="Cancelled">Cancelled</option>
            </select><br><br>
        `;
        container.appendChild(entry);
    }

    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Collect data from form
        const shift = document.getElementById('shift').value;
        const mrNo = document.getElementById('mrNo').value;
        
        // Add data to PDF
        doc.text("Encoding Report", 10, 10);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, 20);
        doc.text(`Shift: ${shift}`, 10, 30);
        doc.text(`Patient MRNo.: ${mrNo}`, 10, 40);

        // Loop through Prescription Issues
        let yOffset = 50;
        document.querySelectorAll('.prescription-entry').forEach((entry, index) => {
            const prescriptionIssue = entry.querySelector('.prescriptionIssue').value;
            const physician = entry.querySelector('.physician').value;
            
            // Collect checkbox values for issue related
            const issueRelated = Array.from(entry.querySelectorAll('.issueRelated:checked'))
                .map(checkbox => checkbox.value).join(', ');
            
            const solution = entry.querySelector('.solution').value;
            
            // Add to PDF
            doc.text(`Prescription Issue #${index + 1}: ${prescriptionIssue}`, 10, yOffset);
            doc.text(`Physician: ${physician}`, 10, yOffset + 10);
            doc.text(`Issue Related: ${issueRelated}`, 10, yOffset + 20);
            doc.text(`Solution: ${solution}`, 10, yOffset + 30);
            yOffset += 40;
        });

        // Remaining fields
        const cancelledOrders = document.getElementById('cancelledOrders').value;
        const notAvailableMedications = document.getElementById('notAvailableMedications').value;
        const notAvailableConsumables = document.getElementById('notAvailableConsumables').value;
        const updates = document.getElementById('updates').value;

        doc.text(`No. of Cancelled Orders: ${cancelledOrders}`, 10, yOffset);
        doc.text(`Not Available Qty Medications: ${notAvailableMedications}`, 10, yOffset + 10);
        doc.text(`Not Available Qty Consumables: ${notAvailableConsumables}`, 10, yOffset + 20);
        doc.text(`Updates: ${updates}`, 10, yOffset + 30);

        // Save PDF
        doc.save('Encoding_Report.pdf');
    }
</script>

</body>
</html>
